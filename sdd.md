# 软件设计说明文档 (Software Design Description)

## 敏捷项目管理平台

**版本**: 1.0  
**编写者**: 项目组  
**日期**: 2026 年 1 月

---

## 目录

- [1. 引言](#1-引言)
  - [1.1 文档目的](#11-文档目的)
  - [1.2 系统范围](#12-系统范围)
  - [1.3 术语表](#13-术语表)
  - [1.4 参考文献](#14-参考文献)
  - [1.5 文档概述](#15-文档概述)
- [2. 设计概述](#2-设计概述)
  - [2.1 利益相关者关注点](#21-利益相关者关注点)
  - [2.2 选定视点](#22-选定视点)
- [3. 设计视图](#3-设计视图)
  - [3.1 上下文视图](#31-上下文视图)
  - [3.2 组成视图](#32-组成视图)
  - [3.3 信息视图](#33-信息视图)
  - [3.4 接口视图](#34-接口视图)
  - [3.5 交互视图](#35-交互视图)
- [4. 架构决策](#4-架构决策)
- [5. 附录](#5-附录)

---

## 修订历史

| 版本 | 日期    | 修改说明 | 作者   |
| ---- | ------- | -------- | ------ |
| 1.0  | 2026-01 | 初始版本 | 项目组 |

---

## 1. 引言

### 1.1 文档目的

本软件设计说明文档（SDD）描述了敏捷项目管理平台的系统架构和详细设计。文档面向以下读者：

- **开发人员**：了解系统架构、模块划分和接口设计，指导编码实现
- **架构师**：评审设计决策，确保架构一致性
- **测试人员**：理解系统结构，制定测试策略
- **运维人员**：了解部署架构和配置需求

本文档与需求规格说明书（SRS）配合使用，将功能需求映射到具体的设计元素。

### 1.2 系统范围

**系统名称**: 敏捷项目管理平台  
**版本**: 1.0

本系统是一个基于 Taiga 和 Tenzu（天図）开源项目进行二次开发的全新敏捷项目管理平台。系统采用微服务架构，将 Taiga 的成熟功能迁移到 Tenzu 的现代技术栈。

**核心能力**：

- Scrum 敏捷管理（Backlog、Sprint、燃尽图）
- Kanban 可视化工作流管理
- 问题追踪与缺陷管理
- 团队协作与知识库
- RESTful API 与第三方集成

**设计边界**：

- ✅ 包含：后端 API 服务、前端用户界面、数据库设计
- ❌ 不包含：移动端 App、离线同步功能

### 1.3 术语表

| 术语         | 定义                                              |
| ------------ | ------------------------------------------------- |
| API          | 应用程序接口，用于系统间通信的协议和工具集        |
| SDD          | 软件设计说明文档，描述系统架构和设计              |
| JWT          | JSON Web Token，用于身份认证的令牌格式            |
| DDD          | 领域驱动设计，以业务领域为核心的软件设计方法      |
| Scrum        | 敏捷开发框架，包含 Sprint、Backlog 等核心概念     |
| Kanban       | 可视化工作流管理方法                              |
| Sprint       | 冲刺，Scrum 中的固定周期迭代                      |
| Backlog      | 待办列表，产品需求的优先级队列                    |
| Epic         | 史诗，跨多个 Sprint 的大型功能                    |
| User Story   | 用户故事，从用户角度描述的功能需求                |
| WIP          | Work In Progress，在制品，Kanban 中限制并发任务数 |
| DRF          | Django REST Framework，Python API 开发框架        |
| Django-Ninja | 现代 Django API 框架，支持 OpenAPI                |

### 1.4 参考文献

| 文档           | 来源                            | 说明                 |
| -------------- | ------------------------------- | -------------------- |
| Taiga REST API | https://docs.taiga.io/api.html  | Taiga 官方 API 文档  |
| Tenzu API      | https://se.etao.net/api/v1/docs | Tenzu 部署实例 API   |
| 项目任务说明   | se_task.txt                     | 项目核心需求定义     |
| 详细设计文档   | 最终文档/文档.md                | 本项目详细设计       |
| IEEE 1016-2009 | IEEE 标准                       | 软件设计说明推荐实践 |

### 1.5 文档概述

本文档结构如下：

- **第 2 章 设计概述**：描述利益相关者关注点和选定的设计视点
- **第 3 章 设计视图**：包含上下文、组成、信息、接口、交互等核心视图
- **第 4 章 架构决策**：记录重要的架构决策及其理由
- **第 5 章 附录**：补充材料，包括数据字典和详细规范

文档使用 Markdown 格式编写，图表使用 draw.io 工具绘制。

---

## 2. 设计概述

### 2.1 利益相关者关注点

| 利益相关者     | 角色描述               | 主要关注点         | 相关视图             |
| -------------- | ---------------------- | ------------------ | -------------------- |
| **项目经理**   | 使用系统管理项目进度   | 易用性、功能完整性 | 上下文视图、交互视图 |
| **开发人员**   | 日常任务管理和状态更新 | 响应速度、界面友好 | 接口视图、交互视图   |
| **系统架构师** | 设计和评审系统架构     | 可扩展性、可维护性 | 组成视图、信息视图   |
| **后端开发者** | 实现 API 和业务逻辑    | 代码结构、API 规范 | 组成视图、接口视图   |
| **前端开发者** | 实现用户界面           | 组件设计、数据流   | 交互视图、接口视图   |
| **运维人员**   | 部署和监控系统         | 部署架构、性能     | 组成视图             |
| **测试人员**   | 验证系统功能           | 测试接口、数据模型 | 接口视图、信息视图   |

### 2.2 选定视点

基于利益相关者的关注点，本文档选定以下设计视点：

#### 2.2.1 上下文视点 (Context)

**目的**: 定义系统边界，识别外部实体和用例。

**关注点**: 系统边界、环境参与者（用户、外部系统）、提供的服务。

**表示语言**: C4 上下文图、UML 用例图。

#### 2.2.2 组成视点 (Composition)

**目的**: 描述系统如何分解为主要组成部分（子系统、组件、模块）。

**关注点**: 职责分配、功能本地化、模块化（复用、构建）、集成。

**表示语言**: 层次分解图、UML 组件图、部署图。

#### 2.2.3 信息视点 (Information)

**目的**: 建模持久化数据结构、关系及访问机制。

**关注点**: 数据结构和语义、持久化、数据完整性、数据管理。

**表示语言**: E-R 图、UML 类图。

#### 2.2.4 接口视点 (Interface)

**目的**: 规范组件、子系统或与外部系统之间的可见接口。

**关注点**: 互操作性、封装、集成风险。

**表示语言**: API 规范、OpenAPI/Swagger。

#### 2.2.5 交互视点 (Interaction)

**目的**: 说明实体如何在运行时通过消息协作。

**关注点**: 职责分配、消息顺序、时序、错误传播。

**表示语言**: UML 序列图、BPMN 流程图。

---

## 3. 设计视图

### 3.1 上下文视图

- **ID**: VIEW-001-Context
- **视点**: 上下文视点 (Context)

#### 3.1.1 系统边界

敏捷项目管理平台作为一个独立的 Web 应用系统，与以下外部实体交互：

**外部参与者**:

| 参与者     | 类型 | 描述                                 |
| ---------- | ---- | ------------------------------------ |
| 普通用户   | 人员 | 开发团队成员，管理日常任务           |
| 项目管理员 | 人员 | 项目负责人，配置项目和分配任务       |
| 系统管理员 | 人员 | 系统运维人员，管理用户和系统配置     |
| 第三方系统 | 系统 | GitHub、GitLab 等，通过 Webhook 集成 |
| 邮件服务   | 系统 | SMTP 服务器，发送通知邮件            |

#### 3.1.2 上下文图

![系统上下文图](https://raw.githubusercontent.com/TreeAWater/software_project/main/%E6%9C%80%E7%BB%88%E6%96%87%E6%A1%A3/drawio/ch1/1_8_context_dfd.png)

#### 3.1.3 主要用例

| 用例分类 | 用例列表                                    |
| -------- | ------------------------------------------- |
| 认证管理 | 用户注册、登录、密码重置、OAuth 登录        |
| 项目管理 | 创建项目、配置模块、邀请成员、角色分配      |
| 敏捷管理 | Backlog 管理、Sprint 规划、任务分解、燃尽图 |
| 看板管理 | 泳道配置、状态流转、WIP 限制                |
| 问题追踪 | 创建问题、分配处理、状态追踪                |
| 知识库   | Wiki 编辑、附件上传                         |

---

### 3.2 组成视图

- **ID**: VIEW-002-Composition
- **视点**: 组成视点 (Composition)

#### 3.2.1 系统层次结构

本系统采用前后端分离的三层架构：

```
┌─────────────────────────────────────────────┐
│                 前端层                       │
│   Angular 21 + TypeScript + SASS            │
└─────────────────────────────────────────────┘
                    ▼ HTTP/JSON
┌─────────────────────────────────────────────┐
│                 API 层                       │
│   Django-Ninja + JWT 认证                    │
└─────────────────────────────────────────────┘
                    ▼
┌─────────────────────────────────────────────┐
│                 业务层                       │
│   Django 5.2 + Celery 异步任务              │
└─────────────────────────────────────────────┘
                    ▼
┌─────────────────────────────────────────────┐
│                 数据层                       │
│   PostgreSQL 16 + Redis 7                   │
└─────────────────────────────────────────────┘
```

#### 3.2.2 后端模块分解

| 模块          | 职责                     | 依赖                    |
| ------------- | ------------------------ | ----------------------- |
| auth          | 用户认证、JWT Token 管理 | users                   |
| users         | 用户模型、个人资料       | base                    |
| projects      | 项目管理核心             | users, base             |
| userstories   | 用户故事管理             | projects                |
| milestones    | 冲刺/Sprint 管理         | projects, userstories   |
| tasks         | 任务管理                 | userstories, milestones |
| issues        | 问题追踪                 | projects                |
| epics         | 史诗管理                 | projects, userstories   |
| wiki          | 知识库                   | projects                |
| notifications | 通知服务                 | users, projects         |
| webhooks      | 外部集成                 | projects                |

![后端模块依赖图](https://raw.githubusercontent.com/TreeAWater/software_project/main/%E6%9C%80%E7%BB%88%E6%96%87%E6%A1%A3/drawio/ch3/3_2_backend_modules.png)

#### 3.2.3 前端模块分解

| 模块      | 职责             |
| --------- | ---------------- |
| auth      | 登录/注册组件    |
| projects  | 项目相关组件     |
| backlog   | Backlog 管理视图 |
| taskboard | Sprint 任务板    |
| kanban    | 看板视图         |
| issues    | 问题列表/详情    |
| wiki      | Wiki 编辑器      |
| admin     | 管理后台         |

![前端模块依赖图](https://raw.githubusercontent.com/TreeAWater/software_project/main/%E6%9C%80%E7%BB%88%E6%96%87%E6%A1%A3/drawio/ch3/3_3_frontend_modules.png)

---

### 3.3 信息视图

- **ID**: VIEW-003-Information
- **视点**: 信息视点 (Information)

#### 3.3.1 全局 E-R 图

![全局E-R图](https://raw.githubusercontent.com/TreeAWater/software_project/main/%E6%9C%80%E7%BB%88%E6%96%87%E6%A1%A3/drawio/ch2/2_1_global_er.png)

#### 3.3.2 核心数据实体

| 实体       | 描述         | 主要属性                             |
| ---------- | ------------ | ------------------------------------ |
| User       | 系统用户     | id, username, email, password_hash   |
| Project    | 项目         | id, name, description, owner_id      |
| Membership | 项目成员关系 | user_id, project_id, role_id         |
| UserStory  | 用户故事     | id, subject, status_id, sprint_id    |
| Task       | 任务         | id, subject, userstory_id, status_id |
| Milestone  | 冲刺/Sprint  | id, name, start_date, end_date       |
| Issue      | 问题         | id, subject, type_id, priority_id    |
| Epic       | 史诗         | id, subject, color                   |
| WikiPage   | Wiki 页面    | id, slug, content                    |

#### 3.3.3 关键关系

- User ↔ Project: 多对多 (通过 Membership)
- Project → Milestone: 一对多
- Milestone → UserStory: 一对多
- UserStory → Task: 一对多
- Epic ↔ UserStory: 多对多

---

### 3.4 接口视图

- **ID**: VIEW-004-Interface
- **视点**: 接口视点 (Interface)

#### 3.4.1 API 设计原则

- RESTful 风格，资源导向
- JSON 格式数据交换
- JWT Bearer Token 认证
- OpenAPI 3.0 规范文档
- 分页、过滤、排序支持

#### 3.4.2 核心 API 端点

**认证 API**

| 端点                    | 方法 | 描述                 |
| ----------------------- | ---- | -------------------- |
| `/api/v1/auth`          | POST | 用户登录，获取 Token |
| `/api/v1/auth/refresh`  | POST | 刷新 Access Token    |
| `/api/v1/auth/register` | POST | 用户注册             |

**项目 API**

| 端点                    | 方法      | 描述         |
| ----------------------- | --------- | ------------ |
| `/api/v1/projects`      | GET       | 获取项目列表 |
| `/api/v1/projects`      | POST      | 创建新项目   |
| `/api/v1/projects/{id}` | GET       | 获取项目详情 |
| `/api/v1/projects/{id}` | PUT/PATCH | 更新项目     |
| `/api/v1/projects/{id}` | DELETE    | 删除项目     |

**用户故事 API**

| 端点                                           | 方法 | 描述             |
| ---------------------------------------------- | ---- | ---------------- |
| `/api/v1/userstories`                          | GET  | 获取用户故事列表 |
| `/api/v1/userstories`                          | POST | 创建用户故事     |
| `/api/v1/userstories/bulk_create`              | POST | 批量创建         |
| `/api/v1/userstories/bulk_update_kanban_order` | POST | 更新看板排序     |

**冲刺 API**

| 端点                            | 方法 | 描述         |
| ------------------------------- | ---- | ------------ |
| `/api/v1/milestones`            | GET  | 获取冲刺列表 |
| `/api/v1/milestones`            | POST | 创建冲刺     |
| `/api/v1/milestones/{id}/stats` | GET  | 获取冲刺统计 |

#### 3.4.3 请求响应示例

**登录请求**:

```json
POST /api/v1/auth
{
  "username": "user@example.com",
  "password": "secret123",
  "type": "normal"
}
```

**登录响应**:

```json
{
  "access": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "username": "user",
    "email": "user@example.com"
  }
}
```

---

### 3.5 交互视图

- **ID**: VIEW-005-Interaction
- **视点**: 交互视点 (Interaction)

#### 3.5.1 用户登录序列

```
┌─────┐          ┌─────────┐          ┌──────────┐          ┌────────┐
│用户 │          │  前端   │          │  API层   │          │数据库  │
└──┬──┘          └────┬────┘          └────┬─────┘          └───┬────┘
   │  输入凭据        │                     │                    │
   │─────────────────>│                     │                    │
   │                  │  POST /api/v1/auth  │                    │
   │                  │────────────────────>│                    │
   │                  │                     │  查询用户          │
   │                  │                     │───────────────────>│
   │                  │                     │  用户数据          │
   │                  │                     │<───────────────────│
   │                  │                     │  验证密码          │
   │                  │                     │  生成JWT Token     │
   │                  │  {access, refresh}  │                    │
   │                  │<────────────────────│                    │
   │  登录成功        │                     │                    │
   │<─────────────────│                     │                    │
```

#### 3.5.2 Sprint 规划序列

```
┌──────┐      ┌─────────┐      ┌──────────┐      ┌────────┐
│PM    │      │  前端   │      │  API层   │      │数据库  │
└──┬───┘      └────┬────┘      └────┬─────┘      └───┬────┘
   │ 创建Sprint    │                │                 │
   │──────────────>│                │                 │
   │               │ POST milestone │                 │
   │               │───────────────>│                 │
   │               │                │ INSERT          │
   │               │                │────────────────>│
   │               │                │ 返回Sprint      │
   │               │<───────────────│<────────────────│
   │               │                │                 │
   │ 拖拽故事到Sprint│               │                 │
   │──────────────>│                │                 │
   │               │ bulk_update    │                 │
   │               │───────────────>│                 │
   │               │                │ UPDATE stories  │
   │               │                │────────────────>│
   │               │<───────────────│<────────────────│
   │ 显示燃尽图    │                │                 │
   │<──────────────│                │                 │
```

---

## 4. 架构决策

### ADR-001: 采用微服务架构

- **ID**: ADR-001-Microservices
- **标题**: 从单体架构迁移到微服务架构
- **背景**: Taiga 原有单体架构在扩展性和部署灵活性方面存在限制。随着功能增加，代码耦合度增高。
- **选项**:
  1. 继续使用单体架构
  2. 采用微服务架构
  3. 采用模块化单体架构
- **决策**: 选择方案 2，采用微服务架构，应用 Strangler Fig 模式逐步迁移。
- **理由**:
  - 支持独立部署和扩展各服务
  - 团队可以并行开发不同服务
  - 故障隔离，单个服务故障不影响整体

### ADR-002: 使用 Django-Ninja 替代 DRF

- **ID**: ADR-002-DjangoNinja
- **标题**: API 框架选型
- **背景**: Django REST Framework 成熟但配置繁琐，Django-Ninja 更现代，支持 OpenAPI 自动生成。
- **选项**:
  1. 继续使用 Django REST Framework
  2. 使用 Django-Ninja
  3. 使用 FastAPI (需要脱离 Django)
- **决策**: 选择方案 2，使用 Django-Ninja。
- **理由**:
  - 保持与 Django ORM 的无缝集成
  - 自动生成 OpenAPI 文档
  - 类型注解提升代码质量

### ADR-003: 前端技术栈升级

- **ID**: ADR-003-Angular
- **标题**: 前端框架升级
- **背景**: Taiga 使用 AngularJS 1.5 + CoffeeScript，技术栈老旧，社区支持减少。
- **决策**: 升级到 Angular 21 + TypeScript。
- **理由**:
  - 更好的性能和开发体验
  - TypeScript 提供类型安全
  - 活跃的社区和长期支持

---

## 5. 附录

### 附录 A: 数据字典

详细数据字典请参考 `最终文档/文档.md` 中的 1.2.3 节。

### 附录 B: API 完整规范

完整 API 文档可在以下地址访问：

- Taiga 参考: https://docs.taiga.io/api.html
- 本系统 API: https://se.etao.net/api/v1/docs

### 附录 C: 参考架构图

所有架构图源文件位于 `最终文档/drawio/` 目录，使用 draw.io 工具编辑。

---

**文档结束**
